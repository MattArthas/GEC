create table GEC_LOCATE_PREBORROW
(
  LOCATE_PREBORROW_ID   NUMBER(38) not null,
  LOCATE_ID             VARCHAR2(30),
  IM_AVAILABILITY_ID    NUMBER(38),
  ASSET_ID              NUMBER(38),
  BUSINESS_DATE         NUMBER(8),
  CLIENT_CD             VARCHAR2(32),
  IM_USER_ID            VARCHAR2(64),
  INVESTMENT_MANAGER_CD VARCHAR2(32),
  FUND_CD               VARCHAR2(4),
  FUND_SOURCE           VARCHAR2(1),
  IM_DEFAULT_FUND_CD    VARCHAR2(4),
  IM_DEFAULT_CLIENT_CD  VARCHAR2(32),
  STRATEGY_ID           NUMBER(38),
  TRANSACTION_CD        VARCHAR2(10),
  ASSET_CODE            VARCHAR2(20),
  ASSET_CODE_TYPE       VARCHAR2(3),
  CUSIP                 VARCHAR2(9),
  ISIN                  VARCHAR2(12),
  SEDOL                 VARCHAR2(7),
  QUIK                  VARCHAR2(5),
  TICKER                VARCHAR2(50),
  ASSET_TYPE_ID			VARCHAR2(1),  
  DESCRIPTION           VARCHAR2(50),
  FILE_VERSION          NUMBER(2) default 24,
  SHARE_QTY             NUMBER(38) default 0,
  RESERVED_SB_QTY       NUMBER(38) default 0,
  SB_QTY_RAL            NUMBER(38) default 0,
  RESERVED_NSB_QTY      NUMBER(38) default 0,
  SB_RATE               NUMBER(9,6) default 0,
  NSB_LOAN_NO           VARCHAR2(250),
  NSB_RATE              NUMBER(9,6) default 0,
  INDICATIVE_RATE       VARCHAR2(10),
  SOURCE_CD             VARCHAR2(64),
  REMAINING_SFP         NUMBER(38) default 0,
  POSITION_FLAG         VARCHAR2(2),
  SB_BROKER             VARCHAR2(250),
  RESTRICTION_CD        VARCHAR2(1) default '0',
  RESERVED_NFS_QTY      NUMBER(38) default 0,
  NFS_BORROW_ID         VARCHAR2(10),
  NFS_RATE              NUMBER(9,6) default 0,
  RESERVED_EXT2_QTY     NUMBER(38) default 0,
  EXT2_BORROW_ID        VARCHAR2(10),
  EXT2_RATE             NUMBER(9,6) default 0,
  STATUS                VARCHAR2(1),
  INITIAL_FLAG          VARCHAR2(1) default 'N' not null,
  UPDATED_BY            VARCHAR2(64),
  UPDATED_AT            DATE,
  CREATED_BY            VARCHAR2(64),
  CREATED_AT            DATE,
  COMMENT_TXT           VARCHAR2(4000),
  INTERNAL_COMMENT_TXT  VARCHAR2(4000),
  TRADER_APPROVED_QTY	NUMBER(38),
  REQUEST_ID			NUMBER(38),
  IM_REQUEST_ID			VARCHAR2(64),
  IM_LOCATE_ID			VARCHAR2(64), 
  TRADE_COUNTRY_CD   	VARCHAR2(3), 
  TRADE_COUNTRY_ALIAS_CD   	VARCHAR2(3), 
  SCHEDULED_AT			DATE,
  AT_POINT_AVAIL_QTY	NUMBER(38),
  AGENCY_BORROW_RATE	VARCHAR2(250),
  RECLAIM_RATE	        VARCHAR2(250),
  ROW_NUMBER            NUMBER(6),
  LIQUIDITY_FLAG        VARCHAR2(3),
  LAST_UPDATED_BY       VARCHAR2(64),
  LAST_UPDATED_AT       DATE
)TABLESPACE GEC
;
comment on table GEC_LOCATE_PREBORROW
  is 'Investment manager requests';
comment on column GEC_LOCATE_PREBORROW.BUSINESS_DATE
  is 'Trade date of the locate request';
comment on column GEC_LOCATE_PREBORROW.CLIENT_CD
  is 'Client name; it is the client_cd in default fund of the IM';
comment on column GEC_LOCATE_PREBORROW.FUND_CD
  is 'DML fund id';
comment on column GEC_LOCATE_PREBORROW.FUND_SOURCE
  is 'F(und) or S(trategy). Fund means user input fund and FUND_CD saves user input fund; Strategy means user input locate level and FUND_CD saves default fund of IM.';
comment on column GEC_LOCATE_PREBORROW.IM_DEFAULT_FUND_CD
  is 'IM default fund';
comment on column GEC_LOCATE_PREBORROW.IM_DEFAULT_CLIENT_CD
  is 'The client_cd of IM default fund in gec_fund table';
comment on column GEC_LOCATE_PREBORROW.TRANSACTION_CD
  is 'Transaction type: locate,short and cover';
comment on column GEC_LOCATE_PREBORROW.SHARE_QTY
  is 'Share quantity';
comment on column GEC_LOCATE_PREBORROW.RESERVED_SB_QTY
  is 'Indicates the quantity of SB shares allocated to this activity';
comment on column GEC_LOCATE_PREBORROW.SB_QTY_RAL
  is 'Indicates the quantity of SB shares that need to be reallocated before booking the SB loan';
comment on column GEC_LOCATE_PREBORROW.RESERVED_NSB_QTY
  is 'Indicates the quantity of NSB shares allocated to this activity';
comment on column GEC_LOCATE_PREBORROW.SB_RATE
  is 'Self Borrow rate';
comment on column GEC_LOCATE_PREBORROW.NSB_RATE
  is 'Non-Self Borrow rate';
comment on column GEC_LOCATE_PREBORROW.SOURCE_CD
  is 'Indicates where the request was from.Values are UI - IM File upload,IM File,UI - IM Loc. Entry,UI - IM Avail Enter,UI - Trader Loc. Entry,UI - IM Copy Paste,GSMAC,API,SMAC,File-Auto.';
comment on column GEC_LOCATE_PREBORROW.REMAINING_SFP
  is 'Remaining SFP box NSB Qty less Reserved NSB Qty';
comment on column GEC_LOCATE_PREBORROW.POSITION_FLAG
  is 'Position code, acceptabale values: "GC" or "SP"';
comment on column GEC_LOCATE_PREBORROW.SB_BROKER
  is 'The value is Fund SB brokers seperated by semicolon[;], eg: XA0997;XA8792;TA8456';
comment on column GEC_LOCATE_PREBORROW.TRADE_COUNTRY_CD
  is 'Trade country, value is GB, AU, CA, US and so on. If trade country value from UI or File is UK then this value is GB for other value same with TRADE_COUNTRY_ALIAS_CD.';
comment on column GEC_LOCATE_PREBORROW.RESTRICTION_CD
  is 'DML security restriction code';
comment on column GEC_LOCATE_PREBORROW.RESERVED_NFS_QTY
  is 'Indicates the quantity of NFS shares allocated to this activity';
comment on column GEC_LOCATE_PREBORROW.RESERVED_EXT2_QTY
  is 'Indicates the quantity of EXT2 shares allocated to this activity';
comment on column GEC_LOCATE_PREBORROW.STATUS
  is 'P-ending, C-anceled, X(Error), F-illed, E-xception, H-old.';
comment on column GEC_LOCATE_PREBORROW.LOCATE_ID
  is 'LOCATE ID TO EXTERNAL SYSTEM.The arithmetic is to_char(sysdate,''J'')+to_char(mod(GEC_LOCATE_ID_SEQ.nextval,1000000),''FM000000'').e.g.2455226000122';
comment on column GEC_LOCATE_PREBORROW.INITIAL_FLAG
  is '"Y" Or "N"."Y":Locate has been imported but not accepted."N":Imported locate has been accepted.';
comment on column GEC_LOCATE_PREBORROW.IM_AVAILABILITY_ID
  is 'Refer to gec_im_availability.IM_AVAILABILITY_ID.';
comment on column GEC_LOCATE_PREBORROW.ASSET_CODE_TYPE
  is 'Refer to ASSET_CODE_TYPE.ASSET_CODE_TYPE.';
comment on column GEC_LOCATE_PREBORROW.FILE_VERSION
  is '24,30.Locate file format. 24:version 2.4;30:version 3.0';     
comment on column GEC_LOCATE_PREBORROW.TRADER_APPROVED_QTY
  is 'The trader approved quantity in Locate/Proborrow Entry';
comment on column GEC_LOCATE_PREBORROW.REQUEST_ID
  is 'Refer to gec_request.REQUEST_ID.';   
comment on column GEC_LOCATE_PREBORROW.IM_REQUEST_ID
  is 'Im Request Id from API specially.';    
comment on column GEC_LOCATE_PREBORROW.IM_LOCATE_ID
  is 'Im locate Id from API specially.';   
comment on column GEC_LOCATE_PREBORROW.ASSET_ID
  is 'Security identifier for this request.Refter to gec_asset.asset_id.';  
comment on column GEC_LOCATE_PREBORROW.SCHEDULED_AT
  is 'For locate with Hold status, this field means the time when the locate should be process in future.';  
comment on column GEC_LOCATE_PREBORROW.ROW_NUMBER
  is 'The row number of the locate/preborrow in the request. It is saved as the value of Oracle rownum.';  
comment on column GEC_LOCATE_PREBORROW.AT_POINT_AVAIL_QTY 
is 'The available qty when the locate/preborrow/short/cover record is created.';
comment on column GEC_LOCATE_PREBORROW.ASSET_TYPE_ID 
is 'Securities type: values: 4 ,0';
comment on column GEC_LOCATE_PREBORROW.TRADE_COUNTRY_ALIAS_CD
is 'Value is GB, UK, AU and so on. It is the value from file or UI, the real value from source. But the value of TRADE_COUNTRY_CD is GB, UK, AU and so on, it it used to store the changed value, more detail see TRADE_COUNTRY_CD comments';
comment on column GEC_LOCATE_PREBORROW.LIQUIDITY_FLAG
is 'Please refer to GEC_ASSET_RATE.LIQUIDITY_FLAG';

alter table GEC_LOCATE_PREBORROW
  add ( constraint GEC_LOCATE_PREBORROW_PK primary key (LOCATE_PREBORROW_ID)  USING INDEX TABLESPACE  GEC);
alter table GEC_LOCATE_PREBORROW
  add constraint GEC_LOCATE_PREBORROW_FK1 foreign key (IM_AVAILABILITY_ID)
  references GEC_IM_AVAILABILITY (IM_AVAILABILITY_ID);
alter table GEC_LOCATE_PREBORROW
  add constraint GEC_LOCATE_PREBORROW_FK2 foreign key (IM_USER_ID)
  references GEC_USER (USER_ID);
alter table GEC_LOCATE_PREBORROW
  add constraint GEC_LOCATE_PREBORROW_FK3 foreign key (ASSET_ID)
  references GEC_ASSET (ASSET_ID);
alter table GEC_LOCATE_PREBORROW
  add constraint GEC_LOCATE_PREBORROW_FK4 foreign key (STRATEGY_ID)
  references GEC_STRATEGY (STRATEGY_ID);
alter table GEC_LOCATE_PREBORROW
  add constraint GEC_LOCATE_PREBORROW_FK5 foreign key (REQUEST_ID)
  references GEC_REQUEST (REQUEST_ID);

--Improve the performance of matching to availability
create index GEC_LOCATE_PREBORROW_IDX1 on GEC_LOCATE_PREBORROW (ASSET_ID, STRATEGY_ID) TABLESPACE GEC;

--Improve the performance of loading daily activities by Boston Date
create index GEC_LOCATE_PREBORROW_IDX2 on GEC_LOCATE_PREBORROW (TRUNC(CREATED_AT)) TABLESPACE GEC;

--this index will improve the performace of deleting availability and loading locates by availability_id
CREATE INDEX GEC_LOCATE_PREBORROW_IDX3 ON GEC_LOCATE_PREBORROW(IM_AVAILABILITY_ID) TABLESPACE GEC;

--for the performance of loading locates/preborrows in IM Locate Security page
create index GEC_LOCATE_PREBORROW_IDX4 on GEC_LOCATE_PREBORROW (BUSINESS_DATE) TABLESPACE GEC;

--improve the performance of delete_request in uploading stored procedure if there were lots of records in gec_locate_preborrow table.
--This index can improve deleting performance only if most records in table has INITIAL_FLAG='N'
--This index can also improve the performance of loading data in trader Locate tab. But if there is not lots of data, it does not works.
create index GEC_LOCATE_PREBORROW_IDX5 on GEC_LOCATE_PREBORROW (INITIAL_FLAG, CREATED_BY) TABLESPACE GEC;


--For API: unique and performance of checking if it is a query API or a create API.
alter table GEC_LOCATE_PREBORROW
  add (constraint GEC_LOCATE_PREBORROW_UK unique (IM_LOCATE_ID, IM_REQUEST_ID) USING INDEX TABLESPACE GEC);

