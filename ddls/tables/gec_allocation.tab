create table GEC_ALLOCATION
(
  ALLOCATION_ID   NUMBER(38) not null,
  BORROW_ID       NUMBER(38),
  LOAN_ID         NUMBER(38),
  IM_ORDER_ID     NUMBER(38),
  ALLOCATION_QTY  NUMBER(38) not null,
  SETTLE_DATE     NUMBER(8),
  RATE            NUMBER(14,6),
  STATUS          VARCHAR2(1) not null,
  PREPAY_DATE	  NUMBER(8),
  PREPAY_RATE	  NUMBER(14,6), 
  RECLAIM_RATE	  NUMBER(9,8),
  OVERSEAS_TAX_PERCENTAGE	NUMBER(9,8),
  DOMESTIC_TAX_PERCENTAGE	NUMBER(9,8),
  MINIMUM_FEE	  NUMBER(14,2),
  MINIMUM_FEE_CD         VARCHAR2(3),
  COLLATERAL_TYPE        VARCHAR2(1),
  COLLATERAL_CURRENCY_CD VARCHAR2(3),
  LAST_UPDATED_AT DATE,
  LAST_UPDATED_BY VARCHAR2(64),
  TRADE_DATE      NUMBER(8),
  TERM_DATE       NUMBER(8),
  EXPECTED_RETURN_DATE	NUMBER(8),
  COMMENT_TXT	VARCHAR2(4000)
) tablespace GEC;

comment on column GEC_ALLOCATION.SETTLE_DATE
  is 'Usually it is loan settle date, but there is a case (manual intervention) that the allocation is done while the loan record has not been created [loan_id is null].';
comment on column GEC_ALLOCATION.RATE
  is 'Usually it is loan rate, but there is a case (manual intervention) that the allocation is done while the loan record has not been created [loan_id is null].';
comment on column GEC_ALLOCATION.PREPAY_DATE
  is 'Usually it is loan PREPAY_DATE(come form borrow), but there is a case (manual intervention) that the allocation is done while trade need upadte the value. 
      After trade enter or update PREPAY_DATE on allocation tab and submit, it store the value from UI.';
comment on column GEC_ALLOCATION.PREPAY_RATE
  is 'Usually it is loan PREPAY_RATE(come from CPTY"s prepay rate),but there is a case (manual intervention) that the allocation is done while trade need upadte the value. 
      After trade enter or update PREPAY_RATE on allocation tab and submit, it store the value from UI.';
comment on column GEC_ALLOCATION.RECLAIM_RATE
  is 'Usually it is loan RECLAIM_RATE(come from CPTY"s NET DEVIDEND),but there is a case (manual intervention) that the allocation is done while trade need upadte the value. 
      After trade enter or update NET DEVIDEND on allocation tab and submit, it store the value from UI.';
comment on column GEC_ALLOCATION.OVERSEAS_TAX_PERCENTAGE
  is 'Same with RECLAIM_RATE';
comment on column GEC_ALLOCATION.DOMESTIC_TAX_PERCENTAGE
  is 'Same with RECLAIM_RATE';    
COMMENT ON COLUMN GEC_ALLOCATION.TRADE_DATE
  IS 'It was used for new column named Loan Trade Date in allocation pane.';
            
ALTER TABLE GEC_ALLOCATION
  ADD CONSTRAINT GEC_ALLOCATION_PK PRIMARY KEY (ALLOCATION_ID)  USING INDEX TABLESPACE  GEC;

alter table GEC_ALLOCATION
  add constraint GEC_ALLOCATION_FK1 foreign key (BORROW_ID)
  references GEC_BORROW(BORROW_ID);   

alter table GEC_ALLOCATION
  add constraint GEC_ALLOCATION_FK2 foreign key (LOAN_ID)
  references GEC_LOAN (LOAN_ID);  
  
alter table GEC_ALLOCATION
  add constraint GEC_ALLOCATION_FK3 foreign key (IM_ORDER_ID)
  references GEC_IM_ORDER (IM_ORDER_ID);    

create index GEC_ALLOCATION_IDX1 on GEC_ALLOCATION (IM_ORDER_ID, BORROW_ID, LOAN_ID) TABLESPACE GEC;
create index GEC_ALLOCATION_IDX2 on GEC_ALLOCATION (BORROW_ID) TABLESPACE GEC;
